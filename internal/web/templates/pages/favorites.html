{{define "title"}}Избранное - PhotoCore{{end}}

{{define "styles"}}
/* Favorites page uses base styles - no additional styles needed */
{{end}}

{{define "content"}}
<main class="main">
    <div class="page-header">
        <h1 class="page-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="gold"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg> Избранное</h1>
    </div>

    {{if .Media}}
    <div class="grid">
        {{range .Media}}
        <div class="media-card" data-id="{{.ID}}" onclick="window.location='/view/{{.ID}}'">
            <img src="/media/{{.ID}}/thumb/small" alt="{{.Filename}}" loading="lazy">
            <span class="favorite-badge" onclick="toggleFavorite('{{.ID}}', event)"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/></svg></span>
            <div class="overlay">
                <div class="filename">{{.Filename}}</div>
            </div>
        </div>
        {{end}}
    </div>
    {{else}}
    <div class="empty-state">
        <h3>Нет избранных</h3>
        <p>Нажмите ★ на любом фото, чтобы добавить в избранное</p>
    </div>
    {{end}}
</main>
{{end}}

{{define "scripts"}}
const favSet = new Set([{{range $id, $_ := .FavSet}}"{{$id}}",{{end}}]);

// На странице избранного все элементы - избранные
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.favorite-badge').forEach(badge => {
        badge.classList.add('active');
    });
});

function toggleFavorite(id, event) {
    event.stopPropagation();
    fetch('/api/media/' + id + '/favorite', { method: 'POST' })
        .then(r => r.json())
        .then(data => {
            const badge = event.target.closest('.favorite-badge');
            if (data.is_favorite) {
                favSet.add(id);
                if (badge) badge.classList.add('active');
                showToast('Добавлено в избранное', 'success');
            } else {
                favSet.delete(id);
                event.target.closest('.media-card').remove();
                showToast('Удалено из избранного', 'info');
            }
        })
        .catch(err => showToast('Ошибка: ' + err.message, 'error'));
}
{{end}}
